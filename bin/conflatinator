#!/usr/bin/env python
# -*- coding: utf-8 -*-
import sys
import pathlib

root_dir = pathlib.Path(sys.argv[0]).resolve().parents[1]
bin_dir = root_dir / 'bin'

# print('root', root_dir)
# print('bin', bin_dir)


def die(msg):
    sys.stderr.write(msg + '\n')
    sys.exit(1)


try:
    import jinja2
except ImportError:
    die("jinja2 is not installed")


try:
    import c11r
except ImportError:
    sys.path.insert(0, str(root_dir))
    try:
        import c11r
    except ImportError as e:
        die("failed to import conflatintor\n"
            "- added local src: {}\n"
            "- syspath: {}\n"
            "- error: {}\n".format(root_dir, sys.path, e))


if __name__ == "__main__":
    import logging
    import c11r.environment
    from c11r.formatting import Formatter
    from c11r.exceptions import ProcessingError

    logging.basicConfig(
        level=logging.DEBUG,
        format='%(asctime)-15s %(name)-15s %(levelname)-8s %(message)s',
    )
    environment = c11r.environment.auto()
    builder = Formatter(environment)
    try:
        builder.run()
    except ProcessingError as e:
        sys.stderr.write("%s\n" % e)
        sys.exit(1)

